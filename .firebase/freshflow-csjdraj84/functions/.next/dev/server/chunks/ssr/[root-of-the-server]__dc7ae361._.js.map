{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanarajjayapalan/Development/App/lib/items.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n\nexport interface GroceryItem {\n    name: string;\n    tamilName?: string;\n    imageUrl?: string; // Kept for backward compat, mapped from imagePath\n    price?: string;\n    id?: number;\n    quantity?: number;\n}\n\nexport interface OrderItem {\n    id: number;\n    orderId: number;\n    itemId: number;\n    itemName: string;\n    quantity: number;\n    item?: GroceryItem; // relation\n}\n\nexport interface Order {\n    id: number;\n    createdAt: Date;\n    updatedAt: Date;\n    totalItems: number;\n    items?: OrderItem[];\n}\n\nexport async function getItems(): Promise<GroceryItem[]> {\n    try {\n        const items = await prisma.item.findMany({\n            orderBy: { createdAt: 'desc' }\n        });\n\n        return items.map(item => ({\n            ...item,\n            tamilName: item.tamilName || undefined,\n            imageUrl: item.imagePath || undefined // Mapped to local path\n        }));\n    } catch (error) {\n        console.error('Error reading items from DB:', error);\n        return [];\n    }\n}\n\n// Helper to save not needed for DB as we use Actions, \n// but kept signature if needed for scripts, though scripts should use prisma directly.\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,4NAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG;AA4B7D,eAAe;IAClB,IAAI;QACA,MAAM,QAAQ,MAAM,OAAO,IAAI,CAAC,QAAQ,CAAC;YACrC,SAAS;gBAAE,WAAW;YAAO;QACjC;QAEA,OAAO,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;gBACtB,GAAG,IAAI;gBACP,WAAW,KAAK,SAAS,IAAI;gBAC7B,UAAU,KAAK,SAAS,IAAI,UAAU,uBAAuB;YACjE,CAAC;IACL,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,EAAE;IACb;AACJ,EAEA,uDAAuD;CACvD,uFAAuF"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanarajjayapalan/Development/App/app/actions/order.ts"],"sourcesContent":["\"use server\";\n\nimport fs from 'fs';\nimport path from 'path';\nimport { GroceryItem, prisma } from '@/lib/items';\nimport { revalidatePath } from 'next/cache';\n\nconst ORDER_FILE = path.join(process.cwd(), 'data/current-order.json');\n\n// Type for the transformed order returned by getOrder\nexport interface OrderWithGroceryItems {\n    id: number;\n    totalItems: number;\n    createdAt: Date;\n    updatedAt: Date;\n    items: GroceryItem[];\n}\n\nexport async function saveOrder(items: GroceryItem[], orderId?: number) {\n    try {\n        // 1. Save to JSON (Legacy support)\n        fs.writeFileSync(ORDER_FILE, JSON.stringify(items, null, 2));\n\n        // 2. Save to Database\n        if (items.length > 0) {\n            if (orderId) {\n                // UPDATE existing order\n                await prisma.$transaction(async (tx) => {\n                    // Update total items\n                    await tx.order.update({\n                        where: { id: orderId },\n                        data: { totalItems: items.reduce((sum, i) => sum + (i.quantity || 1), 0) }\n                    });\n\n                    // Delete existing items\n                    await tx.orderItem.deleteMany({\n                        where: { orderId: orderId }\n                    });\n\n                    // Re-create items\n                    for (const item of items) {\n                        await tx.orderItem.create({\n                            data: {\n                                orderId: orderId,\n                                itemId: item.id!,\n                                itemName: item.name,\n                                quantity: item.quantity || 1\n                            }\n                        });\n                    }\n                });\n            } else {\n                // CREATE new order\n                await prisma.order.create({\n                    data: {\n                        totalItems: items.reduce((sum, i) => sum + (i.quantity || 1), 0),\n                        items: {\n                            create: items.map(item => ({\n                                itemId: item.id!,\n                                itemName: item.name,\n                                quantity: item.quantity || 1\n                            }))\n                        }\n                    }\n                });\n            }\n        }\n\n        revalidatePath('/');\n        return { success: true };\n    } catch (e) {\n        console.error(\"Failed to save order:\", e);\n        return { success: false, error: 'Failed to save' };\n    }\n}\n\nexport async function deleteOrder(orderId: number) {\n    try {\n        // Delete OrderItems first, then Order (to satisfy foreign key constraint)\n        await prisma.$transaction(async (tx) => {\n            await tx.orderItem.deleteMany({\n                where: { orderId: orderId }\n            });\n            await tx.order.delete({\n                where: { id: orderId }\n            });\n        });\n\n        revalidatePath('/');\n        return { success: true };\n    } catch (e) {\n        console.error(\"Failed to delete order:\", e);\n        return { success: false, error: 'Failed to delete' };\n    }\n}\n\nexport async function getOrders() {\n    try {\n        const orders = await prisma.order.findMany({\n            orderBy: { createdAt: 'desc' },\n            include: {\n                items: {\n                    include: {\n                        item: true\n                    }\n                }\n            }\n        });\n\n        // Map Prisma result to Order interface (handling nulls and field mapping)\n        return orders.map(order => ({\n            ...order,\n            items: order.items.map(oi => ({\n                id: oi.id,\n                orderId: oi.orderId,\n                itemId: oi.itemId,\n                itemName: oi.itemName,\n                quantity: oi.quantity,\n                item: oi.item ? {\n                    name: oi.item.name,\n                    id: oi.item.id,\n                    tamilName: oi.item.tamilName || undefined,\n                    imageUrl: oi.item.imagePath || undefined,\n                    createdAt: oi.item.createdAt\n                } : undefined\n            }))\n        }));\n    } catch (e) {\n        console.error(\"Failed to fetch orders:\", e);\n        return [];\n    }\n}\n\nexport async function getOrder(id: number): Promise<OrderWithGroceryItems | null> {\n    try {\n        const order = await prisma.order.findUnique({\n            where: { id },\n            include: { items: { include: { item: true } } }\n        });\n\n        if (!order) return null;\n\n        return {\n            id: order.id,\n            totalItems: order.totalItems,\n            createdAt: order.createdAt,\n            updatedAt: order.updatedAt,\n            items: order.items.map((oi) => ({\n                id: oi.item.id,\n                name: oi.item.name,\n                tamilName: oi.item.tamilName || undefined,\n                imageUrl: oi.item.imagePath || undefined,\n                quantity: oi.quantity\n            }))\n        };\n    } catch (e) {\n        console.error(\"Failed to fetch order:\", e);\n        return null;\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanarajjayapalan/Development/App/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getOrders as '007fa694730b3fd0d5716e5ee1edade58b1092a9de'} from 'ACTIONS_MODULE0'\nexport {getOrder as '4010a2147147757847e35a1f739b01b270ce90af51'} from 'ACTIONS_MODULE0'\nexport {deleteOrder as '40d53fdf4111d5ab7dfa780dc64b41f0f7f54360c1'} from 'ACTIONS_MODULE0'\nexport {saveOrder as '60d2a912b15eb3e68abff7c854ebd52c4c9f66679f'} from 'ACTIONS_MODULE0'\nexport {saveOrder as '60d2a912b15eb3e68abff7c854ebd52c4c9f66679f'} from 'ACTIONS_MODULE0'\nexport {deleteOrder as '40d53fdf4111d5ab7dfa780dc64b41f0f7f54360c1'} from 'ACTIONS_MODULE0'\nexport {getOrders as '007fa694730b3fd0d5716e5ee1edade58b1092a9de'} from 'ACTIONS_MODULE0'\nexport {getOrder as '4010a2147147757847e35a1f739b01b270ce90af51'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}